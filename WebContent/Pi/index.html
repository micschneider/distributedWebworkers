<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Parallele Pi-Berechnung</title>
<script type="text/javascript" src="distributedWorkersFramework.js"></script>
<script type="text/javascript">
	var numberOfWorkers = 1;
	var numberOfMessages = 3;
	var numberOfElements = 10;

	var workerMap = null;
	var numberOfResults;
	var pi;	
	var startTime;

	function init()
	{
		workerMap = new HashMap();
		numberOfResults = 0;
		pi = 0.0;
		startTime = 0;
		
		for ( var i = 0; i < numberOfWorkers; i++)
		{
			var worker = new DistributedWebworker("pi.js");
			worker.addEventListener("message", message, false);
			workerMap.put(i, worker);
		}
		calculate();
	}
	
	function calculate()
	{
		startTime = new Date().getTime();
		for ( var i = 0; i < numberOfMessages; i++)
		{
			var start = i * numberOfElements;
			var workerCounter = i % numberOfWorkers;
			var worker = workerMap.get(workerCounter);
			worker.postMessage("" + start + ";" + numberOfElements);
		}		
	}
	
	function message(e)
	{
		numberOfResults += 1;
		pi += parseFloat(e.data);
		if (numberOfResults == numberOfMessages)
		{
			var finishTime = (new Date().getTime() - startTime)/1000;
			var output = document.getElementById("output");
			output.innerHTML = "FERTIG!<br>PI = " + pi + "<br>Benötigte Zeit: " + finishTime + "s";
		}
	}

	function HashMap()
	{
		this.list = new Array();

		this.put = function(key, value)
		{
			this.list[key] = value;
		};

		this.get = function(key)
		{
			return this.list[key];
		};

		this.remove = function(key)
		{
			this.list[key] = null;
		};
	}// end function HashMap
</script>
</head>
<body>
	<form>
		<input type="button" value="Start" onclick="init()">
	</form>
	<div id="output"></div>
</body>
</html>